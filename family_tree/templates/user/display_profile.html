{% extends 'base.html' %}

{% block title %}Profile - Family Tree{% endblock %}

{% block content %}
<!-- Main Content -->
<div class="container mt-5">
  {% if user.person %}
  <div class="row">
    <!-- Profile Picture Section -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-header bg-white border-0 py-4">
          <div class="d-flex align-items-center">
            <div class="bg-primary bg-opacity-10 rounded-3 p-3 me-3">
              <i class="fas fa-user-circle text-primary fs-4"></i>
            </div>
            <div>
              <h5 class="card-title fw-bold mb-1">Profile Picture</h5>
              <small class="text-muted">Your current profile image</small>
            </div>
          </div>
        </div>

        <div class="card-body p-4 text-center">
          <div class="mb-4">
            {% if profile_image_url %}
            <img class="rounded-circle shadow-sm" src="{{ profile_image_url }}" alt="profile picture"
              style="width: 150px; height: 150px; object-fit: cover;">
            {% else %}
            <img class="rounded-circle shadow-sm" src="{{ url_for('static', filename='profile_pictures/default.jpg') }}"
              alt="default profile picture" style="width: 150px; height: 150px; object-fit: cover;">
            {% endif %}
          </div>

          <!-- Profile Picture Upload Form -->
          <form method="POST" action="" enctype="multipart/form-data" class="mt-3">
            {{ form.hidden_tag() }}
            <div class="mb-3">
              <label for="picture_filename" class="form-label fw-semibold">
                <i class="fas fa-upload me-2"></i>Update Profile Picture
              </label>
              {{ form.picture_filename(class="form-control form-control-sm", id="picture_filename") }}
              {% if form.picture_filename.errors %}
              {% for error in form.picture_filename.errors %}
              <div class="text-danger small mt-1">
                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
              </div>
              {% endfor %}
              {% endif %}
            </div>
            <button type="submit" class="btn btn-primary btn-sm rounded-pill w-100">
              <i class="fas fa-upload me-2"></i>Upload Picture
            </button>
          </form>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card border-0 shadow-sm mt-4 rounded-4">
        <div class="card-body p-4">
          <div class="d-grid gap-2">
            <a href="{{ url_for('user.edit_profile') }}" class="btn btn-outline-primary rounded-pill">
              <i class="fas fa-edit me-2"></i>Edit Profile
            </a>
            <a href="{{ url_for('user.dashboard') }}" class="btn btn-outline-secondary rounded-pill">
              <i class="fas fa-home me-2"></i>Dashboard
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Information -->
    <div class="col-lg-8">
      <div class="card border-0 shadow-lg rounded-4">
        <div class="card-header bg-white border-0 py-4">
          <div class="d-flex align-items-center">
            <div class="bg-info bg-opacity-10 rounded-3 p-3 me-3">
              <i class="fas fa-user text-info fs-4"></i>
            </div>
            <div>
              <h5 class="card-title fw-bold mb-1">Profile Information</h5>
              <small class="text-muted">Your personal details and account information</small>
            </div>
          </div>
        </div>

        <div class="card-body p-4">
          <div class="row g-4">
            <!-- Personal Information -->
            <div class="col-md-6">
              <h6 class="fw-bold text-primary mb-3">
                <i class="fas fa-user me-2"></i>Personal Information
              </h6>
              <div class="profile-details">
                <div class="d-flex align-items-start mb-3">
                  <i class="fas fa-id-card text-primary me-3 mt-1"></i>
                  <div>
                    <strong class="text-dark">Full Name:</strong>
                    <div class="text-muted mt-1">
                      {{ user.person.first_name
                      + (' ' + user.person.middle_name if user.person.middle_name else '')
                      + ' ' + user.person.last_name }}
                    </div>
                  </div>
                </div>

                {% if user.person.gender %}
                <div class="d-flex align-items-start mb-3">
                  <i class="fas fa-venus-mars text-primary me-3 mt-1"></i>
                  <div>
                    <strong class="text-dark">Gender:</strong>
                    <div class="text-muted mt-1">{{ user.person.gender|capitalize }}</div>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>

            <!-- Account Information -->
            <div class="col-md-6">
              <h6 class="fw-bold text-primary mb-3">
                <i class="fas fa-key me-2"></i>Account Information
              </h6>
              <div class="account-details">
                <div class="d-flex align-items-start mb-3">
                  <i class="fas fa-user text-primary me-3 mt-1"></i>
                  <div>
                    <strong class="text-dark">Username:</strong>
                    <div class="text-muted mt-1">{{ user.username }}</div>
                  </div>
                </div>

                <div class="d-flex align-items-start mb-3">
                  <i class="fas fa-envelope text-primary me-3 mt-1"></i>
                  <div>
                    <strong class="text-dark">Email:</strong>
                    <div class="text-muted mt-1">{{ user.email }}</div>
                  </div>
                </div>

                <div class="d-flex align-items-start">
                  <i class="fas fa-calendar text-primary me-3 mt-1"></i>
                  <div>
                    <strong class="text-dark">Member Since:</strong>
                    <div class="text-muted mt-1">{{ user.date_created.strftime('%B %d, %Y') if user.date_created else
                      'Unknown' }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


    </div>
  </div>
  {% else %}
  <!-- No Profile State -->
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm text-center rounded-4">
        <div class="card-body py-5">
          <div class="mb-4">
            <i class="fas fa-user-plus text-muted" style="font-size: 4rem;"></i>
          </div>
          <h4 class="fw-bold text-muted mb-3">No Profile Found</h4>
          <p class="text-muted mb-4">
            You haven't created your profile yet.
            Create your profile to start building your family tree.
          </p>
          <a href="{{ url_for('user.edit_profile') }}" class="btn btn-primary btn-lg rounded-pill">
            <i class="fas fa-plus me-2"></i>Create Profile
          </a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}